1. cài
sudo apt update
sudo apt install libnginx-mod-rtmp -y

2.Cài rtmp
sudo apt purge nginx nginx-common nginx-full -y
sudo apt autoremove -y
sudo apt install nginx libnginx-mod-rtmp -y


3. chỉnh sử nginx.conf
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile on;
    keepalive_timeout 65;
    server_tokens off;

    # HLS web server
    server {
        listen 80;
        server_name _;

        # Serve HLS files
        location /hls {
            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }
            root /usr/share/nginx/html;
            add_header Cache-Control no-cache;
        }

        # Serve player page and assets
        location / {
            root /usr/share/nginx/html;
            index index.html player.html;
        }
    }
}

# RTMP config
rtmp {
    server {
        listen 1935;             # RTMP port
        chunk_size 4096;

        application live {
            live on;
            record off;

            # HLS enabled
            hls on;
            hls_path /usr/share/nginx/html/hls;
            hls_fragment 3;
        }
    }
}

6.tạo thư mục
sudo mkdir -p /usr/share/nginx/html/hls
sudo chmod 777 /usr/share/nginx/html/hls


5. kiểm tra lại và restart nginx
nginx -t && sudo systemctl restart nginx

6.cài SSL
sudo apt update
sudo apt install certbot python3-certbot-nginx -y

7.tạo file sudo nano /etc/nginx/sites-enabled/dagaxyz.online
thêm nội dung vào file:
server {
    listen 80;
    server_name dagaxyz.online www.dagaxyz.online;

    root /usr/share/nginx/html;
    index index.html player.html;

    # HLS location
    location /hls {
        types {
            application/vnd.apple.mpegurl m3u8;
            video/mp2t ts;
        }
        add_header Cache-Control no-cache;
        add_header Access-Control-Allow-Origin *;
        alias /usr/share/nginx/html/hls;
    }

    location / {
        try_files $uri $uri/ =404;
    }
}
sau đó chạy :
sudo certbot --nginx -d dagaxyz.online -d www.dagaxyz.online
dể cấp chứng chỉ
8.thay nội dung file /etc/nginx/sites-enabled/dagaxyz.online





rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        application live {
            live on;
            record off;

            # HLS output
            hls on;
            hls_path /usr/share/nginx/html/hls;
            hls_fragment 3;
            hls_playlist_length 60;
            allow publish all;
            allow play all;
        }
    }
}



rtmp {
    server {
        listen 1935;
        
        application live {
            live on;
            
            # Transcode to multiple qualities
            exec ffmpeg -i rtmp://localhost/live/$name
                -c:v libx264 -preset veryfast -b:v 3000k -s 1920x1080 -f flv rtmp://localhost/hls/$name_1080p
                -c:v libx264 -preset veryfast -b:v 1500k -s 1280x720 -f flv rtmp://localhost/hls/$name_720p
                -c:v libx264 -preset veryfast -b:v 800k -s 854x480 -f flv rtmp://localhost/hls/$name_480p
                -c:v libx264 -preset veryfast -b:v 400k -s 640x360 -f flv rtmp://localhost/hls/$name_360p;
        }
        
        application hls {
            live on;
            hls on;
            hls_path /tmp/hls;
            hls_fragment 3;
            hls_playlist_length 60;
            
            # Enable variant playlist for quality selection
            hls_variant _1080p BANDWIDTH=3000000,RESOLUTION=1920x1080;
            hls_variant _720p BANDWIDTH=1500000,RESOLUTION=1280x720;
            hls_variant _480p BANDWIDTH=800000,RESOLUTION=854x480;
            hls_variant _360p BANDWIDTH=400000,RESOLUTION=640x360;
        }
    }
}


